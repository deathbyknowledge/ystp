<html>

<head>
    <style>
        body {
            font-family: monospace;
            margin: 15px
        }
    </style>
</head>
<title>YSTP</title>

<body>
    <center>
        <h1>Y(our)S(uper)T(ransfer)P(rogram)</h1>
        <br />
        <br />
        <br />
        <div style="display:flex;width: 75%;justify-content: space-evenly;">
            <div>
                <h2>Wanna Send? ðŸš€</h2>
                <div>
                    <input type="file" id="file-btn" />
                </div>
                <br />
                <div>
                    <big id="code"></big>
                </div>
            </div>
            <div>
                <h2>Got mail? ðŸ“©</h2>
                <div>
                    Code
                    <input id="code-input" />
                    <button id="connect-btn">Connect</button>
                </div>
                <br />
                <div id="status"></div>
            </div>
        </div>
        <br />
        <br />
        <button id="restore-btn">Restore</button>
    </center>
</body>
<script src="/client.js"></script>
<script>
    document.getElementById('file-btn').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const sender = new FileSender('/send');

        sender.send(
            file,
            (code) => {
                document.getElementById('code').innerHTML = `Code is ready: <b>${code}</b>`;
            },
            () => {
                document.getElementById('code').innerHTML = `
                    <div>
                        <progress id="progress-sender" max="100" value="0" style="width:300px;"></progress>
                        <span id="progress-sender-label">0%</span>
                    </div>`
            },
            (progress) => {
                document.getElementById('progress-sender').value = progress;
                document.getElementById('progress-sender-label').textContent = progress + '%';
            },
            () => {
                document.getElementById('code').innerHTML = `Sent âœ…`;
            }
        );
    });
    document.getElementById('connect-btn').addEventListener('click', () => {
        const code = document.getElementById('code-input').value.trim();
        if (!code) {
            alert("Enter a code, pretty please.");
            return;
        }

        const receiver = new FileReceiver('/receive');

        receiver.connect(
            code,
            (metadata, acceptCallback) => {
                document.getElementById('status').innerHTML = `Accept file '${metadata.name}' (${metadata.size} bytes)? <button id="accept-btn">Accept</button>`;
                document.getElementById('accept-btn').addEventListener('click', () => {
                    acceptCallback();
                    document.getElementById('status').innerHTML = `
                        <div>
                            <progress id="progress-receiver" max="100" value="0" style="width:300px;"></progress>
                            <span id="progress-receiver-label">0%</span>
                        </div>`;
                });
            },
            (progress) => {
                document.getElementById('progress-receiver').value = progress;
                document.getElementById('progress-receiver-label').textContent = progress + "%";
            },
            (downloadUrl, filename) => {
                document.getElementById('status').innerHTML = `Ready âœ…<br/><a href="${downloadUrl}" download="${filename}">Press to save to disk</a>`;
            },
            (error) => {
                document.getElementById('status').innerText = 'Error occurred. Check console.';
            }
        );
    });

    document.getElementById('restore-btn').addEventListener('click', () => {
        document.getElementById('status').innerHTML = '';
        document.getElementById('code').innerHTML = '';
    });

</script>

</html>